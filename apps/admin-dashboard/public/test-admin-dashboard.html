<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard Service Testing</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .test-section h3 {
            color: #34495e;
            margin-top: 0;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .warning {
            color: #f39c12;
            font-weight: bold;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: white;
            border-left: 4px solid #3498db;
        }
        .result.success {
            border-left-color: #27ae60;
            background-color: #d5f4e6;
        }
        .result.error {
            border-left-color: #e74c3c;
            background-color: #fdf2f2;
        }
        .result.warning {
            border-left-color: #f39c12;
            background-color: #fef9e7;
        }
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .status-card {
            padding: 15px;
            border-radius: 8px;
            background-color: white;
            border: 1px solid #ddd;
        }
        .status-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background-color: #27ae60; }
        .status-warning { background-color: #f39c12; }
        .status-error { background-color: #e74c3c; }
        .status-unknown { background-color: #95a5a6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Admin Dashboard Service Testing</h1>
        
        <div class="test-section">
            <h3>üìä System Status</h3>
            <button onclick="checkSystemStatus()">Check System Status</button>
            <div id="systemStatus"></div>
        </div>

        <div class="test-section">
            <h3>üîß Configuration Testing</h3>
            <button onclick="testConfiguration()">Test Configuration</button>
            <div id="configResults"></div>
        </div>

        <div class="test-section">
            <h3>üåê API Connectivity Testing</h3>
            <button onclick="testAPIConnectivity()">Test API Gateway</button>
            <button onclick="testServiceEndpoints()">Test Service Endpoints</button>
            <div id="apiResults"></div>
        </div>

        <div class="test-section">
            <h3>üîå WebSocket Testing</h3>
            <button onclick="testWebSocket()">Test WebSocket Connection</button>
            <button onclick="testWebSocketEvents()">Test WebSocket Events</button>
            <div id="websocketResults"></div>
        </div>

        <div class="test-section">
            <h3>üõ†Ô∏è Service Integration Testing</h3>
            <div class="status-grid">
                <div class="status-card">
                    <h4>Customer Service</h4>
                    <button onclick="testCustomerService()">Test Customer Service</button>
                    <div id="customerServiceResult"></div>
                </div>
                <div class="status-card">
                    <h4>Inventory Service</h4>
                    <button onclick="testInventoryService()">Test Inventory Service</button>
                    <div id="inventoryServiceResult"></div>
                </div>
                <div class="status-card">
                    <h4>Staff Service</h4>
                    <button onclick="testStaffService()">Test Staff Service</button>
                    <div id="staffServiceResult"></div>
                </div>
                <div class="status-card">
                    <h4>Payment Service</h4>
                    <button onclick="testPaymentService()">Test Payment Service</button>
                    <div id="paymentServiceResult"></div>
                </div>
                <div class="status-card">
                    <h4>Analytics Service</h4>
                    <button onclick="testAnalyticsService()">Test Analytics Service</button>
                    <div id="analyticsServiceResult"></div>
                </div>
                <div class="status-card">
                    <h4>Menu Service</h4>
                    <button onclick="testMenuService()">Test Menu Service</button>
                    <div id="menuServiceResult"></div>
                </div>
                <div class="status-card">
                    <h4>Online Order Service</h4>
                    <button onclick="testOnlineOrderService()">Test Online Order Service</button>
                    <div id="onlineOrderServiceResult"></div>
                </div>
                <div class="status-card">
                    <h4>Tenant Service</h4>
                    <button onclick="testTenantService()">Test Tenant Service</button>
                    <div id="tenantServiceResult"></div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üöÄ Performance Testing</h3>
            <button onclick="testPerformance()">Run Performance Tests</button>
            <div id="performanceResults"></div>
        </div>

        <div class="test-section">
            <h3>üìù Test Results Summary</h3>
            <button onclick="generateTestReport()">Generate Test Report</button>
            <div id="testSummary"></div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:3000';
        const WS_BASE_URL = 'http://localhost:3010';
        
        let testResults = {
            configuration: null,
            apiConnectivity: null,
            websocket: null,
            services: {},
            performance: null
        };

        // Utility functions
        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `result ${type}`;
            result.innerHTML = message;
            container.appendChild(result);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // System Status Check
        async function checkSystemStatus() {
            clearResults('systemStatus');
            addResult('systemStatus', 'üîç Checking system status...', 'info');

            try {
                // Check API Gateway
                const apiResponse = await fetch(`${API_BASE_URL}/health`);
                const apiData = await apiResponse.json();
                
                addResult('systemStatus', `‚úÖ API Gateway: ${apiData.status} (Uptime: ${Math.floor(apiData.uptime)}s)`, 'success');

                // Check WebSocket Service
                try {
                    const wsResponse = await fetch(`${WS_BASE_URL}/health`);
                    const wsData = await wsResponse.json();
                    addResult('systemStatus', `‚úÖ WebSocket Service: ${wsData.status}`, 'success');
                } catch (error) {
                    addResult('systemStatus', `‚ùå WebSocket Service: ${error.message}`, 'error');
                }

                // Check Services Status
                try {
                    const servicesResponse = await fetch(`${API_BASE_URL}/services/status`);
                    if (servicesResponse.ok) {
                        const servicesData = await servicesResponse.json();
                        addResult('systemStatus', 'üìä Backend Services Status:', 'info');
                        
                        if (servicesData.health) {
                            Object.entries(servicesData.health).forEach(([service, status]) => {
                                const statusIcon = status.status === 'healthy' ? '‚úÖ' : 
                                                  status.status === 'offline' ? '‚ùå' : '‚ö†Ô∏è';
                                const statusClass = status.status === 'healthy' ? 'success' : 
                                                   status.status === 'offline' ? 'error' : 'warning';
                                addResult('systemStatus', `${statusIcon} ${service}: ${status.status}`, statusClass);
                            });
                        }
                    } else {
                        addResult('systemStatus', '‚ö†Ô∏è Services status endpoint not available', 'warning');
                    }
                } catch (error) {
                    addResult('systemStatus', `‚ö†Ô∏è Services status check failed: ${error.message}`, 'warning');
                }

            } catch (error) {
                addResult('systemStatus', `‚ùå System status check failed: ${error.message}`, 'error');
            }
        }

        // Configuration Testing
        function testConfiguration() {
            clearResults('configResults');
            addResult('configResults', 'üîß Testing configuration...', 'info');

            try {
                // Test environment variables
                const config = {
                    apiUrl: 'http://localhost:3000', // Would come from env in real app
                    wsUrl: 'http://localhost:3010',
                    appName: 'Restaurant Admin Dashboard',
                    debug: true
                };

                addResult('configResults', `‚úÖ API URL: ${config.apiUrl}`, 'success');
                addResult('configResults', `‚úÖ WebSocket URL: ${config.wsUrl}`, 'success');
                addResult('configResults', `‚úÖ App Name: ${config.appName}`, 'success');
                addResult('configResults', `‚úÖ Debug Mode: ${config.debug}`, 'success');

                // Test feature flags
                const features = {
                    realTimeUpdates: true,
                    multiLocation: true,
                    advancedAnalytics: true,
                    offlineMode: false
                };

                addResult('configResults', 'üö© Feature Flags:', 'info');
                Object.entries(features).forEach(([feature, enabled]) => {
                    const icon = enabled ? '‚úÖ' : '‚ùå';
                    const type = enabled ? 'success' : 'warning';
                    addResult('configResults', `${icon} ${feature}: ${enabled}`, type);
                });

                testResults.configuration = 'passed';
                addResult('configResults', 'üéâ Configuration test completed successfully!', 'success');

            } catch (error) {
                testResults.configuration = 'failed';
                addResult('configResults', `‚ùå Configuration test failed: ${error.message}`, 'error');
            }
        }

        // API Connectivity Testing
        async function testAPIConnectivity() {
            clearResults('apiResults');
            addResult('apiResults', 'üåê Testing API connectivity...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                addResult('apiResults', `‚úÖ API Gateway Health: ${data.status}`, 'success');
                addResult('apiResults', `üìä Response Time: ${Date.now() - performance.now()}ms`, 'info');
                addResult('apiResults', `üíæ Memory Usage: ${JSON.stringify(data.memory)}`, 'info');
                
                testResults.apiConnectivity = 'passed';
            } catch (error) {
                testResults.apiConnectivity = 'failed';
                addResult('apiResults', `‚ùå API connectivity test failed: ${error.message}`, 'error');
            }
        }

        async function testServiceEndpoints() {
            addResult('apiResults', 'üîç Testing service endpoints...', 'info');

            const endpoints = [
                { name: 'Tenants', path: '/api/tenants' },
                { name: 'Menu', path: '/api/menu/categories' },
                { name: 'Inventory', path: '/api/inventory' },
                { name: 'Staff', path: '/api/staff' },
                { name: 'Customers', path: '/api/customers' },
                { name: 'Analytics', path: '/api/analytics' },
                { name: 'Payments', path: '/api/payments' },
                { name: 'Online Orders', path: '/api/online-orders' }
            ];

            for (const endpoint of endpoints) {
                try {
                    const start = performance.now();
                    const response = await fetch(`${API_BASE_URL}${endpoint.path}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const end = performance.now();
                    
                    const statusIcon = response.status < 400 ? '‚úÖ' : 
                                      response.status < 500 ? '‚ö†Ô∏è' : '‚ùå';
                    const statusType = response.status < 400 ? 'success' : 
                                      response.status < 500 ? 'warning' : 'error';
                    
                    addResult('apiResults', 
                        `${statusIcon} ${endpoint.name}: HTTP ${response.status} (${(end - start).toFixed(2)}ms)`, 
                        statusType
                    );
                } catch (error) {
                    addResult('apiResults', `‚ùå ${endpoint.name}: ${error.message}`, 'error');
                }
            }
        }

        // WebSocket Testing
        function testWebSocket() {
            clearResults('websocketResults');
            addResult('websocketResults', 'üîå Testing WebSocket connection...', 'info');

            try {
                // Simulate WebSocket connection test
                addResult('websocketResults', '‚úÖ WebSocket service available', 'success');
                addResult('websocketResults', '‚ö†Ô∏è WebSocket client integration requires actual service imports', 'warning');
                addResult('websocketResults', 'üí° In real app, this would test socket.io-client connection', 'info');
                
                testResults.websocket = 'partial';
            } catch (error) {
                testResults.websocket = 'failed';
                addResult('websocketResults', `‚ùå WebSocket test failed: ${error.message}`, 'error');
            }
        }

        function testWebSocketEvents() {
            addResult('websocketResults', 'üì° Testing WebSocket events...', 'info');
            addResult('websocketResults', 'üí° Event testing requires actual WebSocket connection', 'info');
            addResult('websocketResults', 'üîß Events to test: connection, salesUpdate, newOrder, lowStockAlert', 'info');
        }

        // Service Integration Testing
        async function testCustomerService() {
            clearResults('customerServiceResult');
            addResult('customerServiceResult', 'üë• Testing Customer Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/customers`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('customerServiceResult', 
                    `${statusIcon} Customer Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.customer = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.customer = 'failed';
                addResult('customerServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testInventoryService() {
            clearResults('inventoryServiceResult');
            addResult('inventoryServiceResult', 'üì¶ Testing Inventory Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/inventory`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('inventoryServiceResult', 
                    `${statusIcon} Inventory Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.inventory = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.inventory = 'failed';
                addResult('inventoryServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testStaffService() {
            clearResults('staffServiceResult');
            addResult('staffServiceResult', 'üë®‚Äçüíº Testing Staff Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/staff`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('staffServiceResult', 
                    `${statusIcon} Staff Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.staff = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.staff = 'failed';
                addResult('staffServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testPaymentService() {
            clearResults('paymentServiceResult');
            addResult('paymentServiceResult', 'üí≥ Testing Payment Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/payments`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('paymentServiceResult', 
                    `${statusIcon} Payment Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.payment = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.payment = 'failed';
                addResult('paymentServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testAnalyticsService() {
            clearResults('analyticsServiceResult');
            addResult('analyticsServiceResult', 'üìä Testing Analytics Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/analytics`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('analyticsServiceResult', 
                    `${statusIcon} Analytics Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.analytics = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.analytics = 'failed';
                addResult('analyticsServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testMenuService() {
            clearResults('menuServiceResult');
            addResult('menuServiceResult', 'üçΩÔ∏è Testing Menu Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/menu/categories`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('menuServiceResult', 
                    `${statusIcon} Menu Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.menu = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.menu = 'failed';
                addResult('menuServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testOnlineOrderService() {
            clearResults('onlineOrderServiceResult');
            addResult('onlineOrderServiceResult', 'üõí Testing Online Order Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/online-orders`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('onlineOrderServiceResult', 
                    `${statusIcon} Online Order Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.onlineOrder = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.onlineOrder = 'failed';
                addResult('onlineOrderServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testTenantService() {
            clearResults('tenantServiceResult');
            addResult('tenantServiceResult', 'üè¢ Testing Tenant Service...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/tenants`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                const statusType = response.status < 500 ? 'success' : 'error';
                
                addResult('tenantServiceResult', 
                    `${statusIcon} Tenant Service: HTTP ${response.status}`, 
                    statusType
                );
                
                testResults.services.tenant = response.status < 500 ? 'passed' : 'failed';
            } catch (error) {
                testResults.services.tenant = 'failed';
                addResult('tenantServiceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Performance Testing
        async function testPerformance() {
            clearResults('performanceResults');
            addResult('performanceResults', 'üöÄ Running performance tests...', 'info');

            const performanceTests = [
                { name: 'API Gateway Health', url: `${API_BASE_URL}/health` },
                { name: 'Customer Service', url: `${API_BASE_URL}/api/customers` },
                { name: 'Menu Service', url: `${API_BASE_URL}/api/menu/categories` },
                { name: 'Analytics Service', url: `${API_BASE_URL}/api/analytics` }
            ];

            let totalTime = 0;
            let successCount = 0;

            for (const test of performanceTests) {
                try {
                    const start = performance.now();
                    const response = await fetch(test.url);
                    const end = performance.now();
                    const duration = end - start;
                    
                    totalTime += duration;
                    if (response.status < 500) successCount++;
                    
                    const statusIcon = response.status < 500 ? '‚úÖ' : '‚ùå';
                    const statusType = response.status < 500 ? 'success' : 'error';
                    
                    addResult('performanceResults', 
                        `${statusIcon} ${test.name}: ${duration.toFixed(2)}ms (HTTP ${response.status})`, 
                        statusType
                    );
                } catch (error) {
                    addResult('performanceResults', `‚ùå ${test.name}: ${error.message}`, 'error');
                }
            }

            const avgTime = totalTime / performanceTests.length;
            addResult('performanceResults', `üìä Average Response Time: ${avgTime.toFixed(2)}ms`, 'info');
            addResult('performanceResults', `‚úÖ Success Rate: ${successCount}/${performanceTests.length} (${((successCount/performanceTests.length)*100).toFixed(1)}%)`, 'info');
            
            testResults.performance = {
                averageTime: avgTime,
                successRate: (successCount/performanceTests.length)*100
            };
        }

        // Generate Test Report
        function generateTestReport() {
            clearResults('testSummary');
            addResult('testSummary', 'üìù Generating test report...', 'info');

            const report = {
                timestamp: new Date().toISOString(),
                configuration: testResults.configuration || 'not tested',
                apiConnectivity: testResults.apiConnectivity || 'not tested',
                websocket: testResults.websocket || 'not tested',
                services: testResults.services,
                performance: testResults.performance
            };

            addResult('testSummary', '<pre>' + JSON.stringify(report, null, 2) + '</pre>', 'info');
            
            // Summary
            const totalServices = Object.keys(testResults.services).length;
            const passedServices = Object.values(testResults.services).filter(s => s === 'passed').length;
            
            addResult('testSummary', `üéØ Test Summary:`, 'info');
            addResult('testSummary', `üìä Services Tested: ${totalServices}`, 'info');
            addResult('testSummary', `‚úÖ Services Passed: ${passedServices}`, 'success');
            addResult('testSummary', `‚ùå Services Failed: ${totalServices - passedServices}`, passedServices === totalServices ? 'success' : 'warning');
            
            if (testResults.performance) {
                addResult('testSummary', `‚ö° Average Response Time: ${testResults.performance.averageTime.toFixed(2)}ms`, 'info');
                addResult('testSummary', `üìà Success Rate: ${testResults.performance.successRate.toFixed(1)}%`, 'info');
            }
        }

        // Auto-run system status check on page load
        window.addEventListener('load', () => {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
</body>
</html>